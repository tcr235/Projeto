from tkinter import *
from functools import partial

janela_registro = Tk()

def bt_sim():
    janela_registro.destroy()
    janela = Tk()

    def dataHora():
        from datetime import datetime
        dataHora = datetime.now()
        dataHora = dataHora.strftime("%d/%m/%Y %H:%M")
        return dataHora

    def eliminaBarraEne(string):
        stringNova = ""
        for caractere in string:
            if (caractere != "\n"):
                stringNova += caractere
        return stringNova

    def lerArquivo():
        contas ={}
        arq = open("usuários.txt", "r")
        linhas = arq.readlines()
        arq.close()
        qtdeLogins = len(linhas) // 2
        cont = 0
        while (cont < qtdeLogins):
            login = eliminaBarraEne(linhas[2*cont])
            senha = eliminaBarraEne(linhas[2*cont+1])
            usuarios = (login, senha)
            contas[2*cont+1] = usuarios
            cont += 1
        return contas

    def lerArquivo2():
        dicionario ={}
        arq = open("elementos.txt", "r")
        linhas = arq.readlines()
        arq.close()
        qtdeProdutos = len(linhas) // 6
        cont = 0
        while (cont < qtdeProdutos):
            nomeProduto = eliminaBarraEne(linhas[6*cont])
            codigoProduto = eliminaBarraEne(linhas[6*cont+1])
            notaFiscal = eliminaBarraEne(linhas[6*cont+2])
            quantidade = eliminaBarraEne(linhas[6*cont+3])
            preco = eliminaBarraEne(linhas[6*cont+4])
            dataHora = eliminaBarraEne(linhas[6*cont+5])
            produtos = (nomeProduto, quantidade, preco, dataHora)
            dicionario[codigoProduto + notaFiscal] = produtos
            cont += 1
        print(dicionario)
        return dicionario

    def cadastrarProduto(lista):
        nomeProduto = input("Digite o nome do produto: ")
        codigoProduto = input("Digite o código do produto: ")
        notaFiscal = input("Digite o código da nota fiscal do produto: ")
        quantidade = input("Digite a quantidade do produto: ")
        preco = input("Digite o preço do produto por unidade: ")    
        arq = open("elementos.txt", "a")
        arq.write(nomeProduto)
        arq.write("\n")
        arq.write(codigoProduto)
        arq.write("\n")
        arq.write(notaFiscal)
        arq.write("\n")
        arq.write(quantidade)
        arq.write("\n")
        arq.write(preco)
        arq.write("\n")
        arq.write(dataHora())
        arq.write("\n")
        arq.close()
        produtos = lerArquivo2()
        elementos = produtos.keys()
        for chave in elementos:
            if (produtos[chave] == (nomeProduto, quantidade, preco, dataHora)):
                print("O código de cadastro do produto no sistema é:", chave)

    def cadastrarLogin(lista):
        login = input("Digite o login que deseja cadastrar: ")
        senha = input("Digite a senha que deseja cadastrar: ")      
        arq = open("logins.txt", "a")
        arq.write(login)
        arq.write("\n")
        arq.write(senha)
        arq.write("\n")
        arq.close()
        contas = lerArquivo()
        usuario = contas.keys()
        for chave in usuario:
            if (contas[chave] == (login, senha)):
                print("Sua chave de acesso é:", chave)

    def verificaConta():
        validar = False
        login = ed1.get()
        senha = ed2.get()
        chaveLogin = ed3.get()
        contas = lerArquivo()
        usuario = contas.keys()
        for chave in usuario:
            if (int(chaveLogin) == chave and contas[chave] == (login, senha)):
                validar = True
                return validar

    def bt_click():
        validar = verificaConta()
        produtos = lerArquivo2()

        if (validar):
            janela.destroy()
            janela2 = Tk()

            def opcao(botao):
                comando = botao["text"]

                if (comando == "Cadastrar um produto"):
                    cadastrarProduto(produtos)
                    

            janela2.title("Controle de estoque")

            Label(janela2, text = "1-").grid(row = 0, column = 0)
            Label(janela2, text = "2-").grid(row = 1, column = 0)
            Label(janela2, text = "3-").grid(row = 2, column = 0)
            Label(janela2, text = "4-").grid(row = 3, column = 0)
            Label(janela2, text = "5-").grid(row = 4, column = 0)
            Label(janela2, text = "6-").grid(row = 5, column = 0)

            opcao1 = Button(janela2, text = "Cadastrar um produto", width = 20)
            opcao1.grid(row = 0, column = 1)
            opcao1["command"] = partial(opcao, opcao1)

            opcao2 = Button(janela2, text = "Remover um produto", width = 20)
            opcao2.grid(row = 1, column = 1)
            opcao2["command"] = partial(opcao, opcao2)

            opcao3 = Button(janela2, text = "Buscar um produto", width = 20)
            opcao3.grid(row = 2, column = 1)
            opcao3["command"] = partial(opcao, opcao3)

            opcao4 = Button(janela2, text = "Gerar relatório", width = 20)
            opcao4.grid(row = 3, column = 1)
            opcao4["command"] = partial(opcao, opcao4)

            opcao5 = Button(janela2, text = "Atualizar informações", width = 20)
            opcao5.grid(row = 4, column = 1)
            opcao5["command"] = partial(opcao, opcao5)

            opcao6 = Button(janela2, text = "Sair", width = 20)
            opcao6.grid(row = 5, column = 1)
            opcao6["command"] = partial(opcao, opcao6)
        

            janela2.geometry("500x500+525+150")
            janela2.mainloop()

        else:
            lb["text"] = "Credenciais Inválidas!"
            lb["bg"] = "red"


    janela.title("Login do Sistema")

    login = Label(janela, text = "Login:")
    login.grid(row = 0, column = 0)

    senha = Label(janela, text = "Senha")
    senha.grid(row = 1, column = 0)

    chave = Label(janela, text = "Chave de acesso:")
    chave.grid(row = 2, column = 0)

    lb = Label(janela, text = "")
    lb.grid(row = 4, column = 1)

    ed1 = Entry(janela)
    ed1.grid(row = 0, column = 1)

    ed2 = Entry(janela)
    ed2.grid(row = 1, column = 1)

    ed3 = Entry(janela)
    ed3.grid(row = 2, column = 1)

    bt = Button(janela, text = "Confirmar", command = bt_click)
    bt.grid(row = 3, column = 1)

    janela.geometry("250x125+525+150")
    janela.mainloop()
    

janela_registro.title("Cadastro no sistema")

lb_registro = Label(janela_registro, text = "Você já fez cadastro no sistema?")
lb_registro.grid(row = 0, column = 0, pady = 4)

bt_sim = Button(janela_registro, text = "Sim", width = 10, command = bt_sim)
bt_sim.place(x = 10, y = 25)


bt_nao = Button(janela_registro, text = "Não", width = 10)
bt_nao.place(x = 90, y = 25)


janela_registro.geometry("175x60+525+150")
janela_registro.mainloop()
